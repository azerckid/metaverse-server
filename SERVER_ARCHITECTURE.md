# π“„ κ²μ„ μ„λ²„ μ•„ν‚¤ν…μ² λ…μ„Έμ„ (Game Server Architecture)

## 1. κ°μ” (Overview)
λ³Έ μ„λ²„λ” μ‹¤μ‹κ°„ λ©€ν‹°ν”λ μ΄μ–΄ ν™κ²½μ„ μ§€μ›ν•κΈ° μ„ν• **Socket.io κΈ°λ°μ Node.js μ„λ²„**μ…λ‹λ‹¤. λ³„λ„μ λ°μ΄ν„°λ² μ΄μ¤ μ—†μ΄ λ©”λ¨λ¦¬(In-Memory) μƒμ—μ„ μ μ € μƒνƒλ¥Ό κ΄€λ¦¬ν•λ©°, ν΄λΌμ΄μ–ΈνΈ κ°„μ **μ‹¤μ‹κ°„ μ„μΉ λ™κΈ°ν™”** λ° **μ±„ν… κΈ°λ¥**μ„ μ κ³µν•λ” κ²ƒμ„ λ©μ μΌλ΅ ν•©λ‹λ‹¤.

## 2. κΈ°μ  μ¤νƒ (Tech Stack)
- **Runtime**: Node.js
- **Framework**: Express
- **Protocol**: HTTP / WebSocket (Socket.io)
- **Middleware**: CORS (Cross-Origin Resource Sharing)
- **Language**: TypeScript

## 3. λ°μ΄ν„° κµ¬μ΅° (Data Structures)

### 3.1. μ‚¬μ©μ λ¨λΈ (`User`)
μ„λ²„ λ©”λ¨λ¦¬μ— μ €μ¥λλ” μ‚¬μ©μ κ°μ²΄μ κµ¬μ΅°μ…λ‹λ‹¤.

| ν•„λ“λ… | νƒ€μ… | μ„¤λ… |
| :--- | :--- | :--- |
| `id` | `string` | Socket ID (κ³ μ  μ‹λ³„μ) |
| `nickname` | `string` | μ‚¬μ©μ λ‹‰λ„¤μ„ (μ„ νƒ) |
| `position` | `UserPosition` | 3D κ³µκ°„ μƒμ μΆν‘ (x, y, z) |

### 3.2. μ„μΉ λ¨λΈ (`UserPosition`)
| ν•„λ“λ… | νƒ€μ… | μ„¤λ… |
| :--- | :--- | :--- |
| `x` | `number` | Xμ¶• μΆν‘ (κ°€λ΅) |
| `y` | `number` | Yμ¶• μΆν‘ (λ†’μ΄, κΈ°λ³Έκ°’ 0) |
| `z` | `number` | Zμ¶• μΆν‘ (κΉμ΄) |

## 4. μ†μΌ“ μ΄λ²¤νΈ λ…μ„Έ (Socket Event Specifications)

### 4.1. μ΄κΈ°ν™” λ° μ ‘μ† (Connection)
- **Event**: `connection` (System Event)
- **Action**: ν΄λΌμ΄μ–ΈνΈ μ ‘μ† μ‹ μ„λ²„λ” μ¦‰μ‹ `init` μ΄λ²¤νΈλ¥Ό λ°μ†΅ν•©λ‹λ‹¤.
- **Emit**:
    - `init`: `{ id: string, users: Record<string, User> }`
    - μ ‘μ†ν• ν΄λΌμ΄μ–ΈνΈμ—κ² **μμ‹ μ ID**μ™€ **ν„μ¬ μ ‘μ† μ¤‘μΈ μ „μ²΄ μ μ € λ©λ΅**μ„ μ „λ‹¬ν•©λ‹λ‹¤.

### 4.2. κ²μ„ μ…μ¥ (Join)
- **Event**: `join`
- **Direction**: Client β” Server
- **Payload**: `{ nickname: string }`
- **Logic**:
    1. λλ¤ μ¤ν° μΆν‘ μƒμ„± (x, z: -5 ~ 5 λ²”μ„).
    2. μ‚¬μ©μ κ°μ²΄ μƒμ„± λ° λ©”λ¨λ¦¬ μ €μ¥.
    3. μ ‘μ†μ λ³ΈμΈμ—κ² `joinSuccess` μ „μ†΅.
    4. λ‹¤λ¥Έ μ‚¬μ©μλ“¤μ—κ² `playerJoined` λΈλ΅λ“μΊμ¤νΈ.

### 4.3. μ μ € μ΄λ™ (Movement)
- **Event**: `playerMove`
- **Direction**: Client β” Server
- **Payload**: `{ position: UserPosition }`
- **Logic**:
    - λ©”λ¨λ¦¬ μƒμ ν•΄λ‹Ή μ μ € μ„μΉ μ •λ³΄λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.
    - `playerMoved` μ΄λ²¤νΈλ¥Ό ν†µν•΄ λ‹¤λ¥Έ λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ—κ² μ„μΉ λ³€ν™”λ¥Ό μ „νν•©λ‹λ‹¤.

### 4.4. μ±„ν… (Chat)
- **Event**: `chat`
- **Direction**: Client β” Server
- **Payload**: `{ message: string }`
- **Logic**:
    - `io.emit("chat")`μ„ ν†µν•΄ νƒ€μ„μ¤νƒ¬ν”„μ™€ λ°μ‹ μ μ •λ³΄λ¥Ό ν¬ν•¨ν•μ—¬ λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ—κ² λ©”μ‹μ§€λ¥Ό μ¬μ „μ†΅ν•©λ‹λ‹¤.
    - **Guard**: λ‹‰λ„¤μ„μ΄ μ„¤μ •λμ§€ μ•μ€(μ…μ¥ μ „) μ μ €μ λ©”μ‹μ§€λ” λ¬΄μ‹λ©λ‹λ‹¤.

### 4.5. μ ‘μ† ν•΄μ  (Disconnect)
- **Event**: `disconnect` (System Event)
- **Action**:
    - λ©”λ¨λ¦¬μ—μ„ ν•΄λ‹Ή μ μ € μ •λ³΄λ¥Ό μκµ¬ μ‚­μ ν•©λ‹λ‹¤.
    - `playerLeft` μ΄λ²¤νΈλ¥Ό λΈλ΅λ“μΊμ¤νΈν•μ—¬ ν΄λΌμ΄μ–ΈνΈλ“¤μ΄ ν•΄λ‹Ή μΊλ¦­ν„°λ¥Ό ν™”λ©΄μ—μ„ μ κ±°ν•λ„λ΅ ν•©λ‹λ‹¤.

## 5. μ‹¤ν–‰ ν™κ²½ (Execution)
- **ν¬νΈ**: ν™κ²½ λ³€μ `PORT` λλ” κΈ°λ³Έκ°’ `5050` μ‚¬μ©.
- **μ—”νΈλ¦¬ ν¬μΈνΈ**: `src/index.ts`
- **μ‹¤ν–‰ λ…λ Ή**: `npm run dev` (λλ” μ„¤μ •λ μ¤ν¬λ¦½νΈ)
