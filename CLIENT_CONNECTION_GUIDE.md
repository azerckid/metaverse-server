# π“΅ Metaverse Game Server - ν΄λΌμ΄μ–ΈνΈ μ ‘μ† κ°€μ΄λ“

μ΄ λ¬Έμ„λ” ν”„λ΅ νΈμ—”λ“(ν΄λΌμ΄μ–ΈνΈ) κ°λ°μκ°€ μ†μΌ“ μ„λ²„μ— μ—°κ²°ν•κΈ° μ„ν• ν•„μ μ •λ³΄λ¥Ό λ‹΄κ³  μμµλ‹λ‹¤.  
ν„μ¬ μ„λ²„λ” **Oracle Cloud**μ— λ°°ν¬λμ–΄ μμΌλ©°, **HTTPS/WSS Secure Connection**μ΄ μ μ©λμ–΄ μμµλ‹λ‹¤.

---

## π“ 1. μ„λ²„ μ ‘μ† μ •λ³΄ (Connection Info)

| κµ¬λ¶„ | κ°’ | λΉ„κ³  |
| :--- | :--- | :--- |
| **μ„λ²„ URL** | **`https://140.245.69.42.nip.io`** | **Port λ²νΈ μ—†μ** (443 μ‚¬μ©) |
| **ν”„λ΅ν† μ½** | `wss://` (HTTPS) | μ†μΌ“ ν†µμ‹  μ‹ λ³΄μ• μ—°κ²° ν•„μ |
| **Socket.io λ²„μ „** | `^4.0.0` | ν΄λΌμ΄μ–ΈνΈλ„ v4 μ΄μƒ κ¶μ¥ |
| **Transports** | `["websocket"]` | ν΄λ§ μ—†μ΄ μ¦‰μ‹ μ›Ήμ†μΌ“ μ—°κ²° κ¶μ¥ |

> **β οΈ μ£Όμμ‚¬ν•­**:  
> Vercel λ“± HTTPS ν™κ²½μ—μ„ λ°°ν¬λ ν΄λΌμ΄μ–ΈνΈλ” λ°λ“μ‹ μ„ **HTTPS μ£Όμ†**λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤.  
> (`http://140.245.69.42:5050` μ£Όμ†λ” Mixed Content μ—λ¬λ΅ **μ‚¬μ© λ¶κ°€**)

---

## π’» 2. ν΄λΌμ΄μ–ΈνΈ μ½”λ“ μμ‹ (React/Next.js)

`socket.io-client` λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•μ—¬ μ—°κ²°ν•©λ‹λ‹¤.

### ν¨ν‚¤μ§€ μ„¤μΉ
```bash
npm install socket.io-client
```

### μ†μΌ“ μ—°κ²° μ½”λ“
```typescript
import { io } from "socket.io-client";

// μ„λ²„ μ£Όμ† (HTTPS ν•„μ)
const SOCKET_URL = "https://140.245.69.42.nip.io";

export const socket = io(SOCKET_URL, {
  transports: ["websocket"], // π€ μ¤‘μ”: μ›Ήμ†μΌ“ μ „μ© λ¨λ“
  secure: true,              // π”’ μ¤‘μ”: SSL μ‚¬μ© λ…μ‹
  reconnection: true,        // μλ™ μ¬μ—°κ²°
  reconnectionAttempts: 5,   // μ¬μ—°κ²° μ‹λ„ νμ
});

// μ—°κ²° μƒνƒ ν™•μΈ λ΅κ·Έ
socket.on("connect", () => {
  console.log("β… Server Connected! ID:", socket.id);
});

socket.on("connect_error", (err) => {
  console.error("β Connection Failed:", err.message);
});
```

---

## π“΅ 3. μ΄λ²¤νΈ λ…μ„Έ (Socket Events)

μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ£Όκ³ λ°›λ” ν•µμ‹¬ μ΄λ²¤νΈμ…λ‹λ‹¤.

### [Client -> Server] (λ³΄λ‚΄λ” λ°μ΄ν„°)

| μ΄λ²¤νΈλ… | λ°μ΄ν„° μμ‹ | μ„¤λ… |
| :--- | :--- | :--- |
| **`join`** | `{ x: 0, y: 0, z: 0 }` | ν”λ μ΄μ–΄ μµμ΄ μ ‘μ† λ° μ΄κΈ° μ„μΉ μ „μ†΅ |
| **`updatePosition`** | `{ x: 10, y: 0, z: 5, id: "..." }` | ν”λ μ΄μ–΄ μ΄λ™ μ‹ μ‹¤μ‹κ°„ μΆν‘ μ „μ†΅ |
| **`chatMessage`** | `"μ•λ…•ν•μ„Έμ”!"` | μ±„ν… λ©”μ‹μ§€ μ „μ†΅ |

### [Server -> Client] (λ°›λ” λ°μ΄ν„°)

| μ΄λ²¤νΈλ… | λ°μ΄ν„° νƒ€μ… | μ„¤λ… |
| :--- | :--- | :--- |
| **`currentUsers`** | `Map<string, Position>` | μ ‘μ† μ‹, ν„μ¬ λ§µμ— μλ” λ¨λ“  μ μ € μ •λ³΄ μμ‹  |
| **`newPlayer`** | `{ id: "...", x, y, z }` | μƒλ΅μ΄ μ μ €κ°€ λ“¤μ–΄μ™”μ„ λ• μ•λ¦Ό |
| **`playerMoved`** | `{ id: "...", x, y, z }` | λ‹¤λ¥Έ μ μ €κ°€ μ›€μ§μ€μ„ λ• μΆν‘ μ—…λ°μ΄νΈ |
| **`playerLeft`** | `{ id: "..." }` | λ‹¤λ¥Έ μ μ €κ°€ λ‚κ°”μ„ λ• μ•λ¦Ό |
| **`chatMessage`** | `{ id: "...", message: "..." }` | λ‹¤λ¥Έ μ μ €μ μ±„ν… λ©”μ‹μ§€ μμ‹  |

---

## π›  4. νΈλ¬λΈ”μν… (Troubleshooting)

**Q. `Cannot GET /` μ΄λΌκ³  λ– μ”.**  
**A.** μ •μƒμ…λ‹λ‹¤. μ†μΌ“ μ„λ²„λ” μ›Ήνμ΄μ§€λ¥Ό μ κ³µν•μ§€ μ•μΌλ©°, API μ—”λ“ν¬μΈνΈκ°€ μ•„λ‹λ―€λ΅ λΈλΌμ°μ €μ—μ„λ” 404κ°€ λΉλ‹λ‹¤. μ†μΌ“ μ—°κ²°λ§ λλ©΄ μ„±κ³µμ…λ‹λ‹¤.

**Q. `Connection Refused` λλ” `Time out` μ—λ¬κ°€ λ‚μ”.**  
**A.** λ°©ν™”λ²½ λ¬Έμ μ…λ‹λ‹¤. κ΄€λ¦¬μμ—κ² λ¬Έμν•μ„Έμ”. (ν„μ¬ 80, 443 ν¬νΈ κ°λ°©λ¨)

**Q. `Mixed Content` μ—λ¬κ°€ λ‚μ”.**  
**A.** ν΄λΌμ΄μ–ΈνΈκ°€ HTTPSμΈλ° μ†μΌ“ μ£Όμ†λ¥Ό `http://`λ΅ μΌμ„ λ• λ°μƒν•©λ‹λ‹¤. λ°λ“μ‹ `https://140.245.69.42.nip.io`λ¥Ό μ‚¬μ©ν•μ„Έμ”.
